---
  title: "Does Economic Freedom Improve Environmental Outcomes?"
  description: "EDS222 Final Project"
  author:
    - name: Maxwell Patterson
    - affiliation: Master of Environmental Data Science Program
    - affiliation-url: https://ucsb-meds.github.io/
  date: 12-15-2023
  categories: [R, MEDS, Stats]
  bibliography: references.bib
---

## Introduction

When we scrutinize the relationship between capitalism and environmental impacts, we're engaging in a complex dialogue about efficiency, freedom, and sustainability. Markets act as a powerful mechanism for efficient resource allocation. Yet market-based economies, with the intrinsic drive for growth, often neglect the environmental dimension and impact. This oversight manifests in a key shortcoming: the failure to incorporate environmental costs into the pricing of goods and services.

The role of freedom in global economies brings about a dualistic impact on the environment. The positive aspects are rooted in the innovative potential and efficiency that economic freedom encourages. In a capitalist system, the competitive market can be a catalyst for discovering sustainable and economical production methods. Furthermore, the wealth generated in such systems can boost both private and public investments in environmental initiatives. Regulatory efficiency also stands out as an advantage, offering the ability to quickly adapt and respond to emerging environmental challenges. Unfortunately, there are many reasons why this idealized version falls short. At the end of the day, addressing the climate crisis is a collective action dilemma, since the actions of one person are negligible in the grand scheme of things. This makes it difficult for consumers to support climate-focused goods and services in exchange for relatively cheaper alternatives.

Now, the ugly. Capitalism often leads to aggressive resource use, resulting in issues like deforestation, loss of biodiversity, and water pollution. The tendency of capitalism to prioritize short-term profit over long-term sustainability creates a blind spot for environmental considerations. This short-sighted focus on immediate financial returns often overshadows the broader, more enduring impacts on the environment. Additionally, the burden of environmental degradation in capitalist systems is not evenly distributed. Often, it's the less affluent communities that bear the worst of this degradation, leading to a disparity in environmental impact and quality of life. In fact, the wealthiest 10 percent of the global population are responsible for half of global emissions. [@cnbc]

While capitalism has the potential to foster innovation and generate funds that could benefit environmental conservation, resource exploitation and prioritization of short-term profits present substantial challenges to achieving true environmental sustainability.


### What is *Economic Freedom*?

There is certainly a level of subjectivity, or at least a certain amount of uncertainty, when scoring the freedom of an economy. As a result, it seems impossible to create a perfect score for economic freedom. However, this doesn't mean people haven't tried to create a spectrum to measure how free and open different economies are. 

The *Economic Freedom of the World: 2022 Annual Report* serves as the backbone of the analysis in this exploration. 

### Environmental Outcomes Analyzed
- Level of water stres: freshwater withdrawal as a proportion of available freshwater resources
- Net forest depletion (% of GNI)
- Renewable energy output (% of total total energy output)
- Renewable energy consumption (% of total energy consumption)
- Methane emissions (metric tons of CO2 per capita)

### Predictions



## Coding

DISCUSS METHODOLOGY HERE

First, let's import the libraries we will need to conduct this analysis.

```{r, message=FALSE}
# import libraries
library(here)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(janitor)
library(tidyr)
library(forecast)
library(randomForest)
library(tidyverse)

# clear environment for sanity
rm(list = ls())
```


### Data Cleaning

Now, let's import and clean the data containing the freedom index and other scores by country.

```{r}
# read in freedom data
freedom_raw <- read.csv('data/efw_ratings.csv', header = FALSE)
```

This data needs a good bit of clean up. This next code chunk adjusts the column headers and converts column types appropriately.

```{r, message=FALSE, warning=FALSE}
# set the 5th row as the column names
colnames(freedom_raw) <- freedom_raw[5,]

# remove the first 4 rows since they are now empty and clean names, remove columns 
freedom <- freedom_raw[-c(1:5), ] %>% 
  clean_names() %>% 
  subset(select = -na) %>% 
  subset(select = c(-na_2, -na_3, -na_4, -na_5)) %>% 
  subset(select = -world_bank_region) %>% 
  subset(select = -world_bank_current_income_classification_1990_present)

# convert year columns from char to num
freedom <- freedom %>%
  mutate(across(6:ncol(freedom), as.numeric)) %>% 
  mutate(economic_freedom_summary_index = as.numeric(as.character(economic_freedom_summary_index)))

```


Now, lets move on to reading in the next dataset. The *freedom* data serves as the policy side of the data -- now we want to append and compare environmental outcomes based on different political and economic factors.

```{r}
# read in esg data
esg_wb <- read.csv('data/esg_wb.csv') %>% 
  clean_names()
```

This data also needs to be cleaned up a bit. Let's get to work.

```{r, warning=FALSE}
column_names <- c("x1998_yr1998", "x1999_yr1999", "x2000_yr2000", 
                  "x2001_yr2001", "x2002_yr2002", "x2003_yr2003", 
                  "x2004_yr2004", "x2005_yr2005", "x2006_yr2006", 
                  "x2007_yr2007", "x2008_yr2008", "x2009_yr2009", 
                  "x2010_yr2010", "x2011_yr2011", "x2012_yr2012", 
                  "x2013_yr2013", "x2014_yr2014", "x2015_yr2015", 
                  "x2016_yr2016", "x2017_yr2017", "x2018_yr2018", 
                  "x2019_yr2019", "x2020_yr2020", "x2021_yr2021", 
                  "x2022_yr2022")

# Function to extract and convert the year part of a column name to numeric
extract_year <- function(column_name) {
  year_str <- substr(column_name, 2, 5)
  as.numeric(year_str)
}

first <- names(esg_wb)[1:4]

# Apply the function to each column name
numeric_years <- sapply(column_names, extract_year)

new_cols <- c(first, numeric_years)

names(esg_wb) <- new_cols

esg_wb <- esg_wb %>% 
  mutate(across(5:ncol(.), ~ as.numeric(as.character(.))))
```

```{r}
# make longer so it is compatible to join with freedom data
esg_wb_long <- esg_wb %>%
  pivot_longer(
    cols = '1998':'2022', # Specify the range of columns to pivot
    names_to = "Year", # Name of the new column that will store the years
    values_to = "Value" # Name of the new column that will store the corresponding values
  ) 
```

Finally, let's merge the datasets together by year and country name.

```{r}
# rename the country column in freedom dataset to match esg_wb_long
names(freedom)[names(freedom) == "countries"] <- "country_name"

# rename the year column in freedom dataset to match esg_wb_long
names(freedom)[names(freedom) == "year"] <- "Year"

# perform the join
freedom_esg <- merge(freedom, esg_wb_long, by = c("Year", "country_name"))

freedom_esg <- freedom_esg %>% 
  mutate(Year = as.numeric(as.character(Year)),
         Value = as.numeric(as.character(Value)))

# save dataset as a csv
write.csv(freedom_esg, "freedom_esg.csv", row.names = FALSE)
```

Sweet! Now we have the dataset we will be working with in the analysis. 

### Data Filtering

For convenience, I have created a dataframe for each of the environmental indicators to make the analysis smoother.

```{r}
water_stress <- freedom_esg %>% 
  filter(series_name == "Level of water stress: freshwater withdrawal as a proportion of available freshwater resources")

ag_area <- freedom_esg %>% 
  filter(series_name == "Agricultural land (% of land area)")

forest_depletion <- freedom_esg %>% 
  filter(series_name == "Adjusted savings: net forest depletion (% of GNI)")

coastal_protection <- freedom_esg %>% 
  filter(series_name == "Coastal protection")

renewable_output <- freedom_esg %>% 
  filter(series_name == "Renewable electricity output (% of total electricity output)")

renewable_consumption <- freedom_esg %>% 
  filter(series_name == "Renewable energy consumption (% of total final energy consumption)")

methane_emissions <- freedom_esg %>% 
  filter(series_name == "Methane emissions (metric tons of CO2 equivalent per capita)")
```


### Emissions

In the first piece of analysis, let's look at the emissions data. The units for which the emissions are recorded in the dataset are metric tons of CO2 equivalent per capita. 

First, let's compare the average emission in 2022 by economic freedom quartile

```{r}
# create summary table for mean and stdev of methane emissions for each economic freedom quartile
methane_emissions_quartile <- methane_emissions %>% 
  filter(Year == 2020) %>% 
  group_by(quartile) %>% 
  summarize(avg_methane = mean(Value, na.rm = TRUE),
            std_methane = sd(Value, na.rm = TRUE))

methane_emissions_quartile_plot <- ggplot(methane_emissions_quartile, aes(x = quartile, y = avg_methane)) +
  geom_col() +
  theme_minimal()

methane_emissions_quartile_plot

```


```{r}
methane_col_of_interest <- freedom_esg %>% 
  dplyr::select(Year, quartile, country_name, economic_freedom_summary_index, data, data_3, data_6, x5d_freedom_to_enter_markets_and_compete, series_name, Value) %>% 
  filter(series_name == "Methane emissions (metric tons of CO2 equivalent per capita)")
```

```{r}
methane_lm <- lm(Value ~ data + data_3 + x5d_freedom_to_enter_markets_and_compete, data = methane_col_of_interest)

summary(methane_lm)
```

```{r}
# Ensure 'Value' is numeric
methane_emissions$Value <- as.numeric(methane_emissions$Value)

# Select only numeric columns (excluding 'Value' for now)
numeric_data <- methane_emissions %>% 
  select_if(is.numeric) %>% 
  dplyr::select(-Value)

# Calculate correlation of each numeric column with the 'Value' column
correlations <- sapply(numeric_data, function(x) {
  if(is.numeric(x)) {
    return(cor(x, methane_emissions$Value, use = "complete.obs"))
  } else {
    return(NA)
  }
})

# Convert to a dataframe for easier viewing
correlation_results <- as.data.frame(correlations)

# Sort by the absolute value of correlation to find the strongest correlations
sorted_correlations <- correlation_results %>% 
  rownames_to_column("variable") %>% 
  arrange(desc(abs(correlations)))

# View the results
head(sorted_correlations, 10)
```


### Renewable Energy Consumption

Many countries have ambitious goals in place to become carbon-neutral in the next few decades. Are countries on the right track? Let's look at the countries that consume the most energy: China, United States, India, and Russia. [@statista]

First, let's take a look at the percentage of energy consumption that comes from renewable sources for each of these countries.

```{r}
renewable_consumption_leaders <- renewable_consumption %>% 
  filter(country_name %in% c("United States", "Russian Federation", "China", "India"))

ggplot(renewable_consumption_leaders, aes(x = Year, y = Value, color = country_name)) +
  geom_point()


```

### Forest Depletion

Deforestation is a massive issue that exacerbates the climate crisis.

```{r}
forest_depletion_2020_quartile_summary <- forest_depletion %>% 
  group_by(quartile) %>% 
  filter(Year == 2020) %>% 
  summarize(avg_depletion = mean(Value, na.rm = TRUE),
            std_depletion = sd(Value, na.rm = TRUE))
```



```{r}
# Plotting
ggplot(forest_depletion_2020_quartile_summary, aes(x = factor(quartile), y = avg_depletion)) +
  geom_bar(stat = "identity", position = position_dodge(), fill = "skyblue") +
  geom_errorbar(aes(ymin = avg_depletion - std_depletion, ymax = avg_depletion + std_depletion), 
                width = 0.2, position = position_dodge(0.9)) +
  labs(title = "Average Forest Depletion by Quartile in 2020",
       x = "Economic Freedom Quartile",
       y = "Average Forest Depletion") +
  theme_minimal()
```



Let's run an ANOVA test to determine the significance here.

```{r}
forest_depletion_2020 <- forest_depletion %>% 
  filter(Year == 2020) %>% 
  na.omit()

anova_fd <- aov(Value ~ quartile, data = forest_depletion_2020)

summary(anova_fd)
```




Some analysis to consider:

-   Comparative analysis of economic freedom scores

-   Correlation analysis

-   Regression analysis

-   Time series analysis

-   Cluster analysis

-   Hypothesis testing

-   Random forest analysis

-   Interaction effect
